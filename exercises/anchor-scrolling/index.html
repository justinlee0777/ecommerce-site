<script>
    const msPerFrame = 1000 / 60;
    /** In milliseconds. */
    const duration = 300;
    const frames = duration / msPerFrame;

    /**
     * @param id of the element to anchor scroll to.
     */
    const smoothAnchorScroll = function (id) {
        let i = 1;

        const page = document.body;
        const anchor = document.getElementById(id);

        const distance = anchor.getBoundingClientRect().y;
        const scrollTopPerFrame = distance / frames;

        const setIntervalId = setInterval(() => {
            if (i >= frames) {
                clearInterval(setIntervalId);
                // Need to properly update dots state; bug is probably because of pixel imprecision.
            }

            page.scrollBy({ top: scrollTopPerFrame });

            i = i + 1;
        }, msPerFrame);
    };

    //

    window.addEventListener('load', () => {
        const sectionIds = ['section-1', 'section-2', 'section-3'].reverse();

        [document.body, document.documentElement, window].forEach(rootElement => {
            rootElement.addEventListener('scroll', () => {
                let index = sectionIds
                    .map(sectionId => document.getElementById(sectionId))
                    .findIndex(element => element.getBoundingClientRect().y <= 0);

                if (index < 0) {
                    return;
                }

                index = Math.abs(index - (sectionIds.length - 1));

                const dots = document.querySelectorAll('.page-reference-anchor');

                [...dots].forEach((dot, i) => {
                    if (i === index) {
                        dot.style.backgroundColor = 'black';
                    } else {
                        dot.style.backgroundColor = 'white';
                    }
                });
            }, { passive: true });
        });
    });
</script>

<style>
    body {
        position: relative;
    }

    .section-content {
        height: 500px;
    }

    .navigation-bar {
        display: flex;
    }

    .page-reference {
        position: fixed;
        right: 24px;
        display: flex;
        flex-direction: column;
        top: 50%;
        transform: translateY(-50%);
    }

    .page-reference>.page-reference-anchor:nth-child(n + 2) {
        margin-top: 8px;
    }

    .page-reference-anchor {
        border: 1px solid black;
        border-radius: 50%;
        height: 8px;
        width: 8px;
    }
</style>

<h1>Anchor Smooth Scrolling exercise</h1>

<div class="page-reference">
    <div class="page-reference-anchor" onclick="smoothAnchorScroll('section-1')"></div>
    <div class="page-reference-anchor" onclick="smoothAnchorScroll('section-2')"></div>
    <div class="page-reference-anchor" onclick="smoothAnchorScroll('section-3')"></div>
</div>

<div class="navigation-bar">
    <button onclick="smoothAnchorScroll('section-1')">Section 1</button>
    <button onclick="smoothAnchorScroll('section-2')">Section 2</button>
    <button onclick="smoothAnchorScroll('section-3')">Section 3</button>
</div>

<h2 id="section-1">Section 1</h2>
<p class="section-content"></p>

<h2 id="section-2">Section 2</h2>
<p class="section-content"></p>

<h2 id="section-3">Section 3</h2>
<p class="section-content"></p>

<h2 id="section-4">Section 4</h2>
<p class="section-content"></p>